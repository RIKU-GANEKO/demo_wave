# Demo Wave TODO List

## 海外対応（将来実装）

### フェーズ1: データベース基盤整備
- [ ] Prefecture → Region へのリネーム
  - [ ] `region`テーブルへの移行
  - [ ] `country`テーブルの追加
  - [ ] `country_id`カラムの追加（デフォルト: 日本）
  - [ ] 既存データの移行スクリプト作成
  - [ ] Repository層の更新

### フェーズ2: 多言語対応（i18n）
- [ ] Spring i18nの導入
  - [ ] `messages.properties`の設定
  - [ ] UIテキストの外部化
- [ ] データベース多言語対応
  - [ ] `category_translation`テーブルの追加
  - [ ] `region_translation`テーブルの追加
- [ ] 言語切り替えUI
  - [ ] ヘッダーに言語選択ドロップダウン追加
  - [ ] セッション/Cookie での言語設定保存

### フェーズ3: 海外地域データ追加
- [ ] アメリカ対応
  - [ ] 50州のデータ登録
  - [ ] 英語翻訳
- [ ] ヨーロッパ対応
  - [ ] イギリス、フランス、ドイツなどの地域データ
  - [ ] 各国言語の翻訳
- [ ] アジア対応
  - [ ] 中国、韓国、台湾などの地域データ
  - [ ] 各国言語の翻訳

### フェーズ4: グローバル機能対応
- [ ] タイムゾーン対応
  - [ ] ユーザーのタイムゾーン検出
  - [ ] 開催日時の自動変換表示
- [ ] 通貨対応
  - [ ] 支援金の多通貨対応
  - [ ] 為替レート連携
- [ ] 国別UI/UX調整
  - [ ] 国選択ドロップダウン追加
  - [ ] 選択国に応じた地域フィルター表示

### 設計メモ
- **優先地域**: アメリカ → ヨーロッパ → アジア
- **優先言語**: 英語 → 中国語 → その他
- **段階的リリース**: 日本版リリース後、6ヶ月〜1年で海外展開開始

## タグ機能

### 新規実装
- [ ] タグの追加
  - [ ] タグエンティティの作成
  - [ ] タグとデモの多対多リレーション設定
  - [ ] デモ作成時のタグ選択UI
  - [ ] 検索画面でのタグフィルタリング

## アイコン関連

### DemoWaveアイコンの修正
- [x] 現在のアイコンから周りの白い部分を削除（透過処理）
- [x] 新しいアイコンを全箇所に適用
  - [x] ヘッダー部分
  - [x] フッター部分
  - [x] その他の表示箇所
- [x] ファビコンの設定（共通フラグメント化 + LPページ対応完了）

## デモ一覧画面のUI/UX改善

### 不要要素の削除
- [x] 統計情報セクションの削除
  - [x] 開催中のデモ数
  - [x] 総参加者数
  - [x] 開催都市数
- [x] 「デモ一覧」タイトルの削除

### 機能追加・改善
- [ ] カテゴリフィルタリング機能の実装
- [x] 各デモカードに「総支援額」項目を追加
  - 「参加者」の下に表示
- [ ] ページネーション背景色の修正
  - 現在ページの背景色を太く/明確にする
- [x] 開催日時表示の改善（開始時間〜終了時間形式）
- [x] 検索・フィルタリング機能の完全実装
  - タイトル・詳細文での部分一致検索
  - カテゴリフィルタリング
  - 開催予定のみ表示（開催済みフィルタリング）
  - お気に入りフィルタリング
- [x] お気に入りボタンの機能実装
- [x] デモ詳細文のプレビュー表示（3行分）

### 多言語対応準備
- [ ] 文言の日本語化
  - [ ] `ENDED` → `開催済`
  - [ ] `SCHEDULED` → `開催予定`
  - [ ] その他英語表記の日本語化
- [ ] 将来的なリージョン別言語切替の基盤準備

### 画像機能（将来実装）
- [ ] タイトル・説明文ベースのAI画像生成機能
  - **注意**: MVPには含めない（コスト考慮）
  - 初期リリース後の機能として検討

## LP（ランディングページ）改善

### 未ログインユーザー向け機能
- [ ] LP上でのデモ一覧表示
- [ ] ユーザー登録促進の導線設計
  - [ ] 「参加する」ボタン押下時の登録促進
  - [ ] 「支援金を送る」ボタン押下時の登録促進

## 本番リリース前に必須の作業

### AWS SES 設定
- [ ] **AWS SES Production access をリクエスト**
  - 現在: Sandbox モード（検証済みメールアドレスのみ送信可能）
  - 必要: Production access（任意のメールアドレスに送信可能）
  - 審査期間: 24-72時間
  - リクエスト手順:
    1. AWS Console → SES → アカウントダッシュボード
    2. 「本番アクセスをリクエスト」をクリック
    3. Use case description に以下を記載:
       - トランザクションメールの用途
       - 支援金送信完了メール、デモリマインドメール、ギフトカード配信メール
       - 予想送信数: 月100-500通（初期）→ 月1,000-5,000通（成長期）

### 本番用メールアドレスの準備
- [ ] 本番用メールアドレスを決定
  - 推奨: `noreply.demowave@gmail.com` など、プロフェッショナルな Gmail アカウント
  - または: 独自ドメイン取得後 `noreply@demowave.com`
- [ ] 本番用メールアドレスを AWS SES で検証
- [ ] Railway 環境変数に設定
  - `AWS_ACCESS_KEY_ID`
  - `AWS_SECRET_ACCESS_KEY`
  - `AWS_REGION=ap-northeast-1`
  - `AWS_SES_FROM_EMAIL=（本番用メールアドレス）`

### セキュリティチェック
- [ ] `.gitignore` に `application-dev.properties` が含まれているか確認
- [ ] Git リポジトリにアクセスキーが含まれていないか確認
- [ ] Railway の環境変数が正しく設定されているか確認

## インフラ移行計画（初期リリース後検討）

### Railway → AWS Lightsail 移行

#### 移行タイミング（以下のいずれかに該当した時）
- [ ] ログ調査が頻繁に必要になった（SSHアクセス必要）
- [ ] 月間アクティブユーザー1000人を超えた
- [ ] Railwayの制約（メモリ512MB、CPU 0.5 vCPU）に当たった
- [ ] より細かいサーバー制御が必要になった

#### 費用・スペック比較表

**前提条件:**
- DB: Supabase PostgreSQL（外部サービス）を使用
- 純粋なアプリケーションサーバーのみの比較

| サービス | メモリ | CPU | ストレージ | 帯域幅 | SSL設定 | SSH | 月額 | Railway比 |
|---------|--------|-----|-----------|--------|---------|-----|------|-----------|
| **Railway** | 512MB | 0.5 vCPU共有 | 1GB | 100GB | 自動 | ❌ | **$5** (¥750) | 100% |
| **AWS Lightsail 512MB** | 512MB | 1 vCPU | 20GB SSD | 1TB | 手動 | ✅ | **$3.50** (¥525) | **70%** |
| **AWS Lightsail 1GB** | 1GB | 1 vCPU | 40GB SSD | 2TB | 手動 | ✅ | **$5** (¥750) | **100%** |
| **AWS EC2 t4g.micro** | 1GB | 2 vCPU (ARM) | 20GB | 100GB | 手動 | ✅ | **$8.23** (¥1,235) | 165% |
| **AWS EC2 t3.micro** | 1GB | 2 vCPU (x86) | 20GB | 100GB | 手動 | ✅ | **$9.69** (¥1,454) | 194% |

**注記:**
- EC2の月額にはRoute 53 ($0.50/月)、Elastic IP、EBS含む
- Lightsailは1TB〜2TB帯域幅込み（Railwayの10〜20倍）
- すべてSSL証明書はLet's Encrypt使用（無料）

#### スペック比較の要点

**同じ$5で比較（Railway vs AWS Lightsail 1GB）:**
- メモリ: 512MB → **1GB（2倍）**
- CPU: 0.5 vCPU → **1 vCPU（2倍）**
- ストレージ: 1GB → **40GB（40倍）**
- 帯域幅: 100GB → **2TB（20倍）**
- SSH: ❌ → **✅**
- SSL/デプロイ: 自動 → 手動設定必要

**結論: 同額でスペックが大幅向上、ただし運用の手間が増える**

#### AWS移行時に必要な作業

**初回のみ（計3時間程度）:**
1. **SSL証明書設定（30分）**
   - Let's Encryptを使用（無料）
   - Lightsailなら公式スクリプトで簡単
   ```bash
   sudo certbot --standalone -d demowave.com
   sudo crontab -e  # 自動更新設定
   ```

2. **自動デプロイ設定（2時間）**
   - GitHub Actionsでデプロイ自動化
   - Git push → 自動ビルド → サーバーデプロイ
   - 初回設定のみ、以降は自動

3. **環境変数・設定移行（30分）**
   - Railwayの環境変数をAWSへコピー
   - Supabase接続情報
   - AWS SES認証情報

**日常運用:**
- Railwayと変わらず（自動デプロイ設定済み）
- ログ確認: SSHでサーバーログ直接確認可能
- トラブル時: SSHで詳細調査可能

#### 移行しない場合の対策（Railwayのまま継続）

**ログ管理の課題:**
- Railway標準ログ: 最長1週間保持
- SSH不可: サーバー直接調査不可

**対策: 外部ログサービス導入**
- **Sentry**（推奨、無料枠: 月5,000イベント）
  - エラートラッキング
  - スタックトレース保存
  - メール/Slack通知
- **Logtail** (Railway推奨)
  - ログ集約・長期保存
  - 無料枠あり

**追加コスト:**
- Sentry無料枠のみ: $0/月
- 成長期にSentry有料: $26/月〜

#### 推奨移行戦略

**フェーズ1: MVP〜初期リリース（現在〜3ヶ月）**
- **Railway継続** ($5/月)
- Sentry無料枠でエラー監視
- 理由: デプロイ速度重視、運用コスト最小

**フェーズ2: 成長期（ユーザー1000人超え）**
- **AWS Lightsail 1GB移行検討** ($5/月)
- 理由: 同額でスペック向上、SSH可能
- 初回設定3時間で長期的メリット大

**フェーズ3: 本格運用（ユーザー10000人超え）**
- AWS EC2 + オートスケーリング検討
- コスト: $15〜30/月

## 【MVP外】バッチ機能（将来実装）

### デモ前日PM8時リマインドメール機能
- [ ] デモ前日20時に参加者へリマインドメールを送信
  - 翌日のデモ情報（タイトル、開始時間、場所）を通知

#### 実装上の注意点（Railway / PaaS環境）
**Railway（PaaS）では従来のバッチ実行方法が使用不可：**
- ❌ **Azkaban**: サーバーへのSSHアクセス不可のため導入不可
- ❌ **Cron**: サーバーに直接アクセスできないため設定不可
- ⚠️ **ログ保持期間**: 最長1週間程度（長期ログ保存不可）
- ⚠️ **SSHアクセス**: PaaSのため不可

#### 代替実装手段
**選択肢1: Spring Scheduler（推奨）**
- `@Scheduled` アノテーションでアプリ内スケジューリング
- 追加コストなし、実装シンプル
- Railway上で確実に動作
```java
@Scheduled(cron = "0 0 20 * * *") // 毎日20時
public void sendReminderEmails() { ... }
```

**選択肢2: Railway Cron Jobs**
- Railwayの機能でHTTPエンドポイントを定期実行
- 設定が必要

**選択肢3: 外部サービス**
- AWS EventBridge / Google Cloud Scheduler
- HTTPエンドポイントを叩く
- 追加コストあり

**選択肤4: Azkabanを別サーバーでホスト**
- EC2などで別途Azkabanを動かす
- Railwayのエンドポイントを叩く
- 複雑 & 高コスト

#### エラー監視・通知（必須）
**Railwayのログ制約に対する対策：**
- **選択肢1: メール通知**（SES使用、無料・簡単）
  - バッチエラー時に管理者メールへ通知
- **選択肢2: Slack通知**（推奨）
  - Slack Incoming Webhook使用
  - エラーを即座にSlackに通知
- **選択肢3: Sentry**（有料・高機能）
  - エラートラッキングサービス
  - スタックトレース保存、無料枠あり

## 優先度

### High Priority（初期リリース必須）
- アイコン修正・適用
- デモ一覧画面の基本UI改善
- LP改善
- **AWS SES Production access 申請**（審査に時間がかかるため早めに実施）

### Medium Priority（初期リリース後）
- 多言語対応基盤
- 詳細なUI/UX調整
- **デモ前日リマインドメール機能**（バッチ実装）

### Low Priority（将来検討）
- AI画像生成機能

## デモ作成画面の改善

### 機能修正
- [ ] Google Maps API初期化エラーの修正
- [ ] 会場名から都道府県の自動取得機能
- [ ] デモ登録時の緯度経度null エラー修正（demo_address_latitude）

## マイページ画面の改善

### 不要要素の削除
- [ ] 参加デモ数・アカウント状態・メンバー歴の削除
- [ ] クイックアクションセクションの削除
- [ ] トップのアイコン＋マイページヘッダーセクションの削除

### 機能追加
- [ ] 寄付デモ一覧の表示（金額含む）
- [ ] 受け取った支援金セクションの表示

## 活動報告機能（Twitter連携）

### フェーズ1: 手動運用（現在実装済み）
- [x] デモ作成・編集画面にTwitterリンク入力欄を追加
- [x] デモ詳細画面に「活動報告を見る」ボタンを追加
- [x] 主催者が手動でTwitterスレッドを作成し、URLを登録

### フェーズ2: Twitter自動投稿機能（将来実装）
- [ ] **Twitter API v2 の導入**
  - [ ] Twitter Developer アカウントの取得
  - [ ] API Basic tier（月$100）またはPro tier（月$5,000）の契約検討
  - [ ] OAuth 2.0 認証フロー実装

- [ ] **デモ作成時の自動Twitter投稿**
  - [ ] デモ作成時に管理者Twitterアカウントで自動的にスレッドを作成
  - [ ] スレッドにデモのタイトル、詳細、開催日時、場所を投稿
  - [ ] 作成されたスレッドのURLを自動的にDBに保存

- [ ] **環境変数設定**
  - [ ] `TWITTER_API_KEY`
  - [ ] `TWITTER_API_SECRET`
  - [ ] `TWITTER_ACCESS_TOKEN`
  - [ ] `TWITTER_ACCESS_TOKEN_SECRET`
  - [ ] `TWITTER_ADMIN_ACCOUNT_ID`

#### コスト試算
- **Twitter API Basic tier**: 月$100（約15,000円）
  - 月3,000ツイート投稿まで
  - 月30デモ作成の場合、デモあたり3.3ツイート投稿可能
- **Twitter API Pro tier**: 月$5,000（約75万円）
  - 月10,000ツイート投稿まで
  - スケールアップ時に検討

#### 懸念事項・リスク
- **API料金の高さ**: 初期段階では月$100のコストが重い
- **Twitter（X）の仕様変更リスク**: Elon Musk買収後、APIの仕様・料金が頻繁に変更
- **アカウント凍結リスク**: 大量自動投稿が凍結対象になる可能性
- **外部依存**: Twitterサービス停止時の影響

#### 実装優先度
- **優先度: Low**
- **実装タイミング**: ユーザー数1000人超え、かつ月間デモ作成数が100件を超えた時点で検討
- **前提条件**:
  - Twitter API料金を賄えるだけの収益が確保できていること
  - 手動運用での課題（主催者が面倒でTwitterリンクを登録しない等）が顕在化していること