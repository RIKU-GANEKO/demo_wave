<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title th:text="${demo.title} + ' - Demo Wave'">ãƒ‡ãƒ¢è©³ç´° - Demo Wave</title>
  <meta name="description" content="Demo Waveã§ãƒ‡ãƒ¢æ´»å‹•ã®è©³ç´°æƒ…å ±ã‚’ã”è¦§ãã ã•ã„">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    * { font-family: 'Inter', sans-serif; }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .glass-effect {
      backdrop-filter: blur(16px) saturate(180%);
      background-color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .text-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .animate-fade-in {
      animation: fadeIn 0.8s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
    }
    
    .status-active {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    .status-upcoming {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    }
    
    .status-ended {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50">

<!-- Header -->
<header class="gradient-bg shadow-lg sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 py-4">
    <div class="flex justify-between items-center">
      <!-- Logo -->
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
          <i class="fas fa-bullhorn text-white text-lg"></i>
        </div>
        <h1 class="text-2xl font-bold text-white">Demo Wave</h1>
      </div>
      
      <!-- Navigation -->
      <nav class="flex items-center space-x-6">
        <a href="/demo_wave/demo" class="text-white hover:text-yellow-300 transition-colors flex items-center">
          <i class="fas fa-arrow-left mr-2"></i>ä¸€è¦§ã«æˆ»ã‚‹
        </a>
        <a href="/demo_wave/lp.html" class="text-white hover:text-yellow-300 transition-colors flex items-center">
          <i class="fas fa-home mr-2"></i>ãƒ›ãƒ¼ãƒ 
        </a>
        <a href="/demo_wave/logout" class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-full hover:bg-opacity-30 transition-all">
          <i class="fas fa-sign-out-alt mr-2"></i>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        </a>
      </nav>
    </div>
  </div>
</header>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 py-8">
  <!-- Hero Section -->
  <div class="animate-fade-in mb-8">
    <div class="glass-effect rounded-3xl p-8 shadow-2xl">
      <!-- Status Badge -->
      <div class="flex justify-between items-start mb-6">
        <span class="status-active text-white text-sm font-semibold px-4 py-2 rounded-full">
          ğŸ”´ é–‹å‚¬ä¸­
        </span>
        <span class="text-sm text-gray-500" th:text="${#temporals.format(demo.createdAt, 'yyyyå¹´MMæœˆddæ—¥ HH:mm')} + ' ã«æŠ•ç¨¿'">
          2025å¹´01æœˆ15æ—¥ 14:00 ã«æŠ•ç¨¿
        </span>
      </div>
      
      <!-- Title -->
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6" th:text="${demo.title}">
        æ°—å€™å¤‰å‹•å¯¾ç­–ã‚’æ±‚ã‚ã‚‹ç·Šæ€¥ãƒ‡ãƒ¢
      </h1>
      
      <!-- Quick Info Grid -->
      <div class="grid md:grid-cols-3 gap-6 mb-8">
        <!-- Date & Time -->
        <div class="flex items-center bg-white bg-opacity-70 rounded-2xl p-4">
          <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center mr-4">
            <i class="fas fa-calendar-alt text-white text-lg"></i>
          </div>
          <div>
            <div class="text-sm text-gray-500">é–‹å‚¬æ—¥æ™‚</div>
            <div class="font-semibold text-gray-900" th:text="${#temporals.format(demo.demoStartDate, 'yyyyå¹´MMæœˆddæ—¥ HH:mm')}">
              2025å¹´01æœˆ15æ—¥ 14:00
            </div>
          </div>
        </div>
        
        <!-- Location -->
        <div class="flex items-center bg-white bg-opacity-70 rounded-2xl p-4">
          <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center mr-4">
            <i class="fas fa-map-marker-alt text-white text-lg"></i>
          </div>
          <div>
            <div class="text-sm text-gray-500">é–‹å‚¬å ´æ‰€</div>
            <div class="font-semibold text-gray-900" th:text="${demo.demoPlace}">
              æ¸‹è°·é§…å‰åºƒå ´
            </div>
          </div>
        </div>
        
        <!-- Participants -->
        <div class="flex items-center bg-white bg-opacity-70 rounded-2xl p-4">
          <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center mr-4">
            <i class="fas fa-users text-white text-lg"></i>
          </div>
          <div>
            <div class="text-sm text-gray-500">å‚åŠ è€…æ•°</div>
            <div class="font-semibold text-gray-900" th:text="${participantCount} + 'äºº'">
              245äºº
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Grid -->
  <div class="grid lg:grid-cols-3 gap-8">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-8">
      <!-- Description -->
      <div class="bg-white rounded-2xl p-8 shadow-lg animate-fade-in">
        <div class="flex items-center mb-6">
          <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center mr-4">
            <i class="fas fa-quote-left text-white"></i>
          </div>
          <h2 class="text-2xl font-bold text-gray-900">ãƒ‡ãƒ¢ã®å†…å®¹</h2>
        </div>
        <div class="prose prose-lg max-w-none text-gray-700 leading-relaxed">
          <th:block th:if="${demo.content}">
            <th:block th:each="str, stat : ${demo.content.split('\r\n|\r|\n', -1)}">
              <th:block th:text="${str}"/>
              <br th:if="${!stat.last}"/>
            </th:block>
          </th:block>
        </div>
      </div>

      <!-- Map Section -->
      <div class="bg-white rounded-2xl p-8 shadow-lg animate-fade-in">
        <div class="flex items-center mb-6">
          <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center mr-4">
            <i class="fas fa-map text-white"></i>
          </div>
          <h2 class="text-2xl font-bold text-gray-900">ä¼šå ´ãƒãƒƒãƒ—</h2>
        </div>
        <div id="map" class="w-full h-96 rounded-xl overflow-hidden shadow-lg"></div>
      </div>

      <!-- Comments Section -->
      <div class="bg-white rounded-2xl p-8 shadow-lg animate-fade-in">
        <div class="flex items-center mb-6">
          <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center mr-4">
            <i class="fas fa-comments text-white"></i>
          </div>
          <h2 class="text-2xl font-bold text-gray-900">ã‚³ãƒ¡ãƒ³ãƒˆ</h2>
        </div>
        
        <!-- Comment List -->
        <div class="space-y-4 mb-8">
          <th:block th:each="comment : ${comments}">
            <div class="bg-gray-50 rounded-xl p-6">
              <p class="text-gray-800 mb-3" th:text="${comment.content}">
                ã¨ã¦ã‚‚æ„ç¾©ã®ã‚ã‚‹ãƒ‡ãƒ¢ã ã¨æ€ã„ã¾ã™ã€‚å‚åŠ ã•ã›ã¦ã„ãŸã ãã¾ã™ï¼
              </p>
              <p class="text-sm text-gray-500" th:text="${#temporals.format(comment.createdAt, 'yyyyå¹´MMæœˆddæ—¥ HH:mm')}">
                2025å¹´01æœˆ14æ—¥ 10:30
              </p>
            </div>
          </th:block>
          
          <!-- Empty State -->
          <div th:if="${#lists.isEmpty(comments)}" class="text-center py-8">
            <i class="fas fa-comment-slash text-gray-300 text-4xl mb-4"></i>
            <p class="text-gray-500">ã¾ã ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>
          </div>
        </div>
        
        <!-- Comment Form -->
        <form th:action="@{/demo/comment/create}" method="post" class="space-y-4">
          <input type="hidden" th:name="demoId" th:value="${demo.id}" />
          <div>
            <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
              ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
            </label>
            <textarea
              id="content"
              name="content"
              rows="4"
              placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
              class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-100 focus:border-purple-400 outline-none resize-none"
              required
            ></textarea>
          </div>
          <div class="flex justify-end">
            <button type="submit" class="gradient-bg text-white font-semibold px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all">
              <i class="fas fa-paper-plane mr-2"></i>é€ä¿¡
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Stats Card -->
      <div class="bg-white rounded-2xl p-6 shadow-lg animate-fade-in">
        <h3 class="text-xl font-bold text-gray-900 mb-6">çµ±è¨ˆæƒ…å ±</h3>
        
        <div class="space-y-6">
          <!-- Participants -->
          <div class="text-center">
            <div class="w-16 h-16 gradient-bg rounded-2xl flex items-center justify-center mx-auto mb-3">
              <i class="fas fa-users text-white text-2xl"></i>
            </div>
            <div class="text-3xl font-bold text-purple-600" th:text="${participantCount}">245</div>
            <div class="text-sm text-gray-500">å‚åŠ è€…æ•°</div>
          </div>
          
          <!-- Support Amount -->
          <div class="text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center mx-auto mb-3">
              <i class="fas fa-yen-sign text-white text-2xl"></i>
            </div>
            <div class="text-3xl font-bold text-green-600" th:text="'Â¥' + ${donateAmount}">Â¥125,000</div>
            <div class="text-sm text-gray-500">æ”¯æ´é‡‘ç·é¡</div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="space-y-4 animate-fade-in">
        <!-- Participate Button -->
        <form th:action="@{/demo/{id}/participant/add(id=${demo.id})}" method="post" class="w-full">
          <button type="submit" class="card-hover w-full gradient-bg text-white font-semibold py-4 px-6 rounded-xl shadow-lg hover:shadow-xl flex items-center justify-center">
            <i th:class="${isParticipant} ? 'fas fa-user-minus' : 'fas fa-user-plus'" class="mr-3"></i>
            <span th:text="${isParticipant} ? 'ã“ã®ãƒ‡ãƒ¢æ´»å‹•ã¸ã®å‚åŠ ã‚’ã‚„ã‚ã‚‹' : 'ã“ã®ãƒ‡ãƒ¢æ´»å‹•ã«å‚åŠ ã™ã‚‹'">
              ã“ã®ãƒ‡ãƒ¢æ´»å‹•ã«å‚åŠ ã™ã‚‹
            </span>
          </button>
        </form>
        
        <!-- Support Button -->
        <form th:action="@{/payment/create-checkout-session}" method="post" class="w-full">
          <input type="hidden" name="demoId" th:value="${demo.id}"/>
          <button type="submit" class="card-hover w-full bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold py-4 px-6 rounded-xl shadow-lg hover:shadow-xl flex items-center justify-center">
            <i class="fas fa-heart mr-3"></i>
            ã“ã®ãƒ‡ãƒ¢æ´»å‹•ã«æ”¯æ´é‡‘ã‚’é€ã‚‹
          </button>
        </form>
        
        <!-- Share Button -->
        <button onclick="shareDemo()" class="card-hover w-full bg-gray-100 text-gray-700 font-semibold py-4 px-6 rounded-xl shadow-lg hover:shadow-xl flex items-center justify-center">
          <i class="fas fa-share-alt mr-3"></i>
          ã“ã®ãƒ‡ãƒ¢ã‚’ã‚·ã‚§ã‚¢
        </button>
      </div>
    </div>
  </div>
</main>

<!-- Footer -->
<footer class="bg-gray-900 text-white py-12 mt-16">
  <div class="max-w-7xl mx-auto px-4 text-center">
    <div class="flex items-center justify-center space-x-3 mb-6">
      <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
        <i class="fas fa-bullhorn text-white text-xl"></i>
      </div>
      <h3 class="text-2xl font-bold text-gradient">Demo Wave</h3>
    </div>
    <p class="text-gray-400 mb-6">ã‚ãªãŸã®å£°ãŒç¤¾ä¼šã‚’å¤‰ãˆã‚‹åŠ›ã«ãªã‚‹</p>
    <p class="text-sm text-gray-500">&copy; 2025 Demo Wave. All rights reserved.</p>
  </div>
</footer>

<!-- Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAiFNfCul_CGWIOeknZs1Yr_0L9kniEuJE&callback=initMap" async defer></script>
<script th:inline="javascript">
  // Google Maps APIã®åˆæœŸåŒ–é–¢æ•°
  function initMap() {
    // ç·¯åº¦ãƒ»çµŒåº¦ã‚’å–å¾— (Thymeleafã§åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹)
    const latitude = /*[[${demo.demoAddressLatitude}]]*/ 35.6895; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: æ±äº¬
    const longitude = /*[[${demo.demoAddressLongitude}]]*/ 139.6917; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: æ±äº¬

    // Google Mapsã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š
    const mapOptions = {
      center: { lat: latitude, lng: longitude },
      zoom: 15,
      styles: [
        {
          "featureType": "all",
          "elementType": "geometry.fill",
          "stylers": [{"weight": "2.00"}]
        },
        {
          "featureType": "all",
          "elementType": "geometry.stroke",
          "stylers": [{"color": "#9c9c9c"}]
        },
        {
          "featureType": "all",
          "elementType": "labels.text",
          "stylers": [{"visibility": "on"}]
        }
      ]
    };

    // Google Mapsã‚’æç”»
    const map = new google.maps.Map(document.getElementById("map"), mapOptions);

    // ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
    const marker = new google.maps.Marker({
      position: { lat: latitude, lng: longitude },
      map: map,
      title: "ãƒ‡ãƒ¢ä¼šå ´",
      animation: google.maps.Animation.BOUNCE
    });

    // æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’è¿½åŠ 
    const infoWindow = new google.maps.InfoWindow({
      content: `
        <div style="padding: 10px;">
          <h3 style="margin: 0 0 10px 0; color: #667eea; font-weight: bold;">ãƒ‡ãƒ¢ä¼šå ´</h3>
          <p style="margin: 0; color: #666;">${/*[[${demo.demoPlace}]]*/ 'æ¸‹è°·é§…å‰åºƒå ´'}</p>
        </div>
      `
    });

    marker.addListener('click', function() {
      infoWindow.open(map, marker);
    });
  }

  // ã‚·ã‚§ã‚¢æ©Ÿèƒ½
  function shareDemo() {
    if (navigator.share) {
      navigator.share({
        title: /*[[${demo.title}]]*/ 'ãƒ‡ãƒ¢æ´»å‹•',
        text: 'Demo Waveã§ãƒ‡ãƒ¢æ´»å‹•ã®è©³ç´°ã‚’ãƒã‚§ãƒƒã‚¯ï¼',
        url: window.location.href
      });
    } else {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
      navigator.clipboard.writeText(window.location.href).then(() => {
        alert('URLãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸï¼');
      });
    }
  }

  // ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });

  // Supabase OAuthèªè¨¼å¾Œã®URL ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  window.addEventListener('load', function() {
    if (window.location.hash && window.location.hash.includes('access_token')) {
      console.log('Cleaning up OAuth tokens from URL');
      // URLã‹ã‚‰ãƒãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã—ã¦ã‚¯ãƒªãƒ¼ãƒ³ã«ã™ã‚‹
      window.history.replaceState({}, document.title, window.location.pathname + window.location.search);
    }
  });
</script>

<!-- Stripe SDK -->
<script src="https://js.stripe.com/v3/"></script>

</body>
</html>
