<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>デモ作成 - Demo Wave</title>
  <meta name="description" content="Demo Waveで新しいデモ活動を作成してください">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    * { font-family: 'Inter', sans-serif; }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .glass-effect {
      backdrop-filter: blur(16px) saturate(180%);
      background-color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .text-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .animate-fade-in {
      animation: fadeIn 0.8s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .input-focus {
      transition: all 0.3s ease;
    }
    
    .input-focus:focus {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(102, 126, 234, 0.25);
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50">

<!-- Header -->
<header class="gradient-bg shadow-lg sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 py-4">
    <div class="flex justify-between items-center">
      <!-- Logo -->
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
          <i class="fas fa-bullhorn text-white text-lg"></i>
        </div>
        <h1 class="text-2xl font-bold text-white">Demo Wave</h1>
      </div>
      
      <!-- Navigation -->
      <nav class="flex items-center space-x-6">
        <a href="/demo_wave/demo" class="text-white hover:text-yellow-300 transition-colors flex items-center">
          <i class="fas fa-arrow-left mr-2"></i>一覧に戻る
        </a>
        <a href="/demo_wave/lp.html" class="text-white hover:text-yellow-300 transition-colors flex items-center">
          <i class="fas fa-home mr-2"></i>ホーム
        </a>
        <a href="/demo_wave/logout" class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-full hover:bg-opacity-30 transition-all">
          <i class="fas fa-sign-out-alt mr-2"></i>ログアウト
        </a>
      </nav>
    </div>
  </div>
</header>

<!-- Main Content -->
<main class="max-w-4xl mx-auto px-4 py-8">
  <!-- Page Header -->
  <div class="text-center mb-12 animate-fade-in">
    <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">新しいデモを作成</h1>
    <p class="text-xl text-gray-600 max-w-2xl mx-auto">
      あなたの声を社会に届けるデモ活動を企画しましょう
    </p>
  </div>

  <!-- Form Container -->
  <div class="bg-white rounded-3xl shadow-2xl p-8 animate-fade-in">
    <div class="flex items-center mb-8">
      <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center mr-4">
        <i class="fas fa-plus text-white text-xl"></i>
      </div>
      <h2 class="text-3xl font-bold text-gray-900">デモ詳細情報</h2>
    </div>
    <form method="post" th:action="@{/demo/create}" th:object="${demoForm}" class="space-y-8">
      <!-- Basic Information Section -->
      <div class="bg-gray-50 rounded-2xl p-6">
        <h3 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
          <i class="fas fa-info-circle text-purple-600 mr-3"></i>
          基本情報
        </h3>
        <div class="space-y-6">
          <!-- Title -->
          <div>
            <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-heading text-purple-500 mr-2"></i>デモタイトル *
            </label>
            <input type="text"
              id="title"
              name="title"
              placeholder="例：気候変動対策を求める緊急デモ"
              class="input-focus w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-100 focus:border-purple-400 outline-none"
            />
            <p th:if="${#fields.hasErrors('title')}" class="mt-2 text-sm text-red-600" th:errors="*{title}"></p>
          </div>

          <!-- Category -->
          <div>
            <label for="categoryId" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-tags text-purple-500 mr-2"></i>カテゴリ *
            </label>
            <select
              id="categoryId"
              name="categoryId"
              class="input-focus w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-100 focus:border-purple-400 outline-none"
            >
              <option value="">カテゴリを選択してください</option>
              <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"></option>
            </select>
            <p th:if="${#fields.hasErrors('categoryId')}" class="mt-2 text-sm text-red-600" th:errors="*{categoryId}"></p>
          </div>

          <!-- Content -->
          <div>
            <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-file-alt text-purple-500 mr-2"></i>デモの詳細説明 *
            </label>
            <textarea
              id="content"
              name="content"
              rows="6"
              placeholder="デモの目的、背景、参加者へのメッセージなどを詳しく記入してください..."
              class="input-focus w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-100 focus:border-purple-400 outline-none resize-none"
            ></textarea>
            <p th:if="${#fields.hasErrors('content')}" class="mt-2 text-sm text-red-600" th:errors="*{content}"></p>
          </div>
        </div>
      </div>

      <!-- Schedule Section -->
      <div class="bg-blue-50 rounded-2xl p-6">
        <h3 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
          <i class="fas fa-calendar-alt text-blue-600 mr-3"></i>
          開催日程
        </h3>
        <div class="space-y-6">
          <!-- Demo Date -->
          <div>
            <label for="demoDate" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-calendar text-blue-500 mr-2"></i>開催日 *
            </label>
            <input type="date"
              id="demoDate"
              name="demoDate"
              class="input-focus w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-400 outline-none"
            />
            <p th:if="${#fields.hasErrors('demoDate')}" class="mt-2 text-sm text-red-600" th:errors="*{demoDate}"></p>
          </div>
          
          <!-- Time Range -->
          <div class="grid md:grid-cols-2 gap-6">
            <!-- Start Time -->
            <div>
              <label for="demoStartTime" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-clock text-blue-500 mr-2"></i>開始時間 *
              </label>
              <input type="time"
                id="demoStartTime"
                name="demoStartTime"
                class="input-focus w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-400 outline-none"
              />
              <p th:if="${#fields.hasErrors('demoStartTime')}" class="mt-2 text-sm text-red-600" th:errors="*{demoStartTime}"></p>
            </div>
            
            <!-- End Time -->
            <div>
              <label for="demoEndTime" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-clock text-blue-500 mr-2"></i>終了時間 *
              </label>
              <input type="time"
                id="demoEndTime"
                name="demoEndTime"
                class="input-focus w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-400 outline-none"
              />
              <p th:if="${#fields.hasErrors('demoEndTime')}" class="mt-2 text-sm text-red-600" th:errors="*{demoEndTime}"></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Location Section -->
      <div class="bg-green-50 rounded-2xl p-6">
        <h3 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
          <i class="fas fa-map-marker-alt text-green-600 mr-3"></i>
          開催場所
        </h3>
        <div class="space-y-6">
          <!-- Place Name -->
          <div>
            <label for="demoPlace" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-building text-green-500 mr-2"></i>会場名 *
            </label>
            <input type="text"
              id="demoPlace"
              name="demoPlace"
              placeholder="例：渋谷駅前広場、国会議事堂前など"
              class="input-focus w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-green-100 focus:border-green-400 outline-none"
            />
            <p th:if="${#fields.hasErrors('demoPlace')}" class="mt-2 text-sm text-red-600" th:errors="*{demoPlace}"></p>
          </div>
          
          <!-- Prefecture -->
          <div>
            <label for="prefectureId" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-map-pin text-green-500 mr-2"></i>都道府県 *
            </label>
            <select
              id="prefectureId"
              name="prefectureId"
              class="input-focus w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-green-100 focus:border-green-400 outline-none"
            >
              <option value="">都道府県を選択してください</option>
              <option th:each="prefecture : ${prefectures}" th:value="${prefecture.id}" th:text="${prefecture.name}"></option>
            </select>
            <p th:if="${#fields.hasErrors('prefectureId')}" class="mt-2 text-sm text-red-600" th:errors="*{prefectureId}"></p>
          </div>

          <!-- Address -->
          <div>
            <label for="demoAddress" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-map text-green-500 mr-2"></i>住所 *
            </label>
            <input type="text"
              id="demoAddress"
              name="demoAddress"
              placeholder="例：渋谷区道玄坂1-1"
              class="input-focus w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-green-100 focus:border-green-400 outline-none"
            />
          </div>
          
          <!-- Map Button -->
          <div class="flex justify-center">
            <button type="button" id="showMapButton" class="card-hover gradient-bg text-white font-semibold px-6 py-3 rounded-xl shadow-lg flex items-center space-x-2">
              <i class="fas fa-map-marked-alt"></i>
              <span>Google Mapで確認</span>
            </button>
          </div>
          
          <!-- Map Container -->
          <div id="map" class="w-full h-96 rounded-xl overflow-hidden shadow-lg" style="display: none;"></div>
          
          <!-- Hidden Fields -->
          <input type="hidden" id="demoAddressLatitude" name="demoAddressLatitude" />
          <input type="hidden" id="demoAddressLongitude" name="demoAddressLongitude" />
        </div>
      </div>

      <!-- Submit Button -->
      <div class="text-center pt-4">
        <button type="submit" class="card-hover gradient-bg text-white font-bold px-12 py-4 rounded-xl shadow-lg text-lg flex items-center space-x-3 mx-auto">
          <i class="fas fa-eye"></i>
          <span>内容を確認する</span>
        </button>
        <p class="text-sm text-gray-500 mt-3">
          次のページで入力内容を確認できます
        </p>
      </div>
    </form>
  </div>


<!--    <script>-->
<!--        (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({-->
<!--          key: "GOOGLE_MAPS_API_KEY_REMOVED",-->
<!--          v: "weekly",-->
<!--          // Use the 'v' parameter to indicate the version to use (weekly, beta, alpha, etc.).-->
<!--          // Add other bootstrap parameters as needed, using camel case.-->
<!--        });-->
<!--    </script>-->
    <script
            src="https://maps.googleapis.com/maps/api/js?key=GOOGLE_MAPS_API_KEY_REMOVED&callback=initMap"
            async
            defer
    ></script>
    <script>
        let geocoder; // Geocoder インスタンス
    let map; // Map インスタンス
    let latLng; // 緯度経度を保持する変数

    // 初期化処理
    function initMap() {
        geocoder = new google.maps.Geocoder();

        // 地図を初期化 (デフォルト位置)
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 35.6895, lng: 139.6917 }, // 初期位置は東京
            zoom: 12,
        });
    }

    // Geocoding で住所から緯度経度を取得
    function geocodeAddress(address) {
        if (!geocoder) {
            alert("Google Maps API がまだ初期化されていません");
            return;
        }

        geocoder.geocode({ address: address }, (results, status) => {
            if (status === "OK") {
                // 緯度経度を取得して変数に保存
                latLng = results[0].geometry.location;
                console.log("Geocoding results:", results);
                console.log("Lat:", latLng.lat());
                console.log("Lng:", latLng.lng());

                // 緯度経度を隠しフィールドに設定
                document.getElementById("demoAddressLatitude").value = latLng.lat();
                document.getElementById("demoAddressLongitude").value = latLng.lng();

                // 地図を表示
                displayMap(latLng);
            } else {
                console.error("Geocode failed due to:", status);
                alert("住所の取得に失敗しました: " + status);
            }
        });
    }

    // 地図を指定した緯度経度で表示
    function displayMap(latLng) {
        // 地図を指定した緯度経度に移動
        map.setCenter(latLng);

        // マーカーを表示
        new google.maps.Marker({
            position: latLng,
            map: map,
            title: "指定した場所",
        });

        // 地図を表示
        document.getElementById("map").style.display = "block";  // 地図を表示する
    }

    window.onload = () => {
        // ボタンのクリックイベントを設定
        document.getElementById("showMapButton").addEventListener("click", () => {
            const address = document.getElementById("demoAddress").value;
            if (address) {
                geocodeAddress(address);
            } else {
                alert("住所を入力してください");
            }
        });
    };

    </script>
    <script>
        $(function () {
            $('#announcementTime').daterangepicker({
                "singleDatePicker": true,
                "timePicker": true,
                "timePicker24Hour": true,
                "autoApply": true,
                "locale": {
                    "format": "YYYY-MM-DD HH:mm",
                    "applyLabel": "Apply",
                    "cancelLabel": "Cancel",
                    "fromLabel": "From",
                    "toLabel": "To",
                    "customRangeLabel": "Custom",
                    "weekLabel": "W",
                    "daysOfWeek": [
                        "日",
                        "月",
                        "火",
                        "水",
                        "木",
                        "金",
                        "土"
                    ],
                    "monthNames": [
                        "1月",
                        "2月",
                        "3月",
                        "4月",
                        "5月",
                        "6月",
                        "7月",
                        "8月",
                        "9月",
                        "10月",
                        "11月",
                        "12月"
                    ],
                    "firstDay": 1
                },
                "showCustomRangeLabel": false,
                startDate: moment().startOf('hour'),
            }, function (start, end, label) {
                console.log('New date range selected: ' + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD') + ' (predefined range: ' + label + ')');
            });

            // #demoDate の初期化
            $('#demoDate').daterangepicker({
                "singleDatePicker": true,
                "timePicker": true,
                "timePicker24Hour": true,
                "autoApply": true,
                "locale": {
                    "format": "YYYY-MM-DD HH:mm",
                    "applyLabel": "Apply",
                    "cancelLabel": "Cancel",
                    "fromLabel": "From",
                    "toLabel": "To",
                    "customRangeLabel": "Custom",
                    "weekLabel": "W",
                    "daysOfWeek": [
                        "日", "月", "火", "水", "木", "金", "土"
                    ],
                    "monthNames": [
                        "1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"
                    ],
                    "firstDay": 1
                },
                "showCustomRangeLabel": false,
                startDate: moment().startOf('hour'),
            }, function (start, end, label) {
                console.log('New date selected for demoDate: ' + start.format('YYYY-MM-DD HH:mm') + ' (predefined range: ' + label + ')');
            });
        });

    </script>
</main>

<!-- Footer -->
<footer class="bg-gray-900 text-white py-12 mt-16">
  <div class="max-w-7xl mx-auto px-4 text-center">
    <div class="flex items-center justify-center space-x-3 mb-6">
      <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
        <i class="fas fa-bullhorn text-white text-xl"></i>
      </div>
      <h3 class="text-2xl font-bold text-gradient">Demo Wave</h3>
    </div>
    <p class="text-gray-400 mb-6">あなたの声が社会を変える力になる</p>
    <p class="text-sm text-gray-500">&copy; 2025 Demo Wave. All rights reserved.</p>
  </div>
</footer>

<!-- jQuery -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>

<!-- Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key=GOOGLE_MAPS_API_KEY_REMOVED&callback=initMap" async defer></script>

<script>
  let geocoder;
  let map;
  let latLng;

  // Google Maps initialization
  function initMap() {
    geocoder = new google.maps.Geocoder();
    
    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 35.6895, lng: 139.6917 },
      zoom: 15,
      styles: [
        {
          "featureType": "all",
          "elementType": "geometry.fill",
          "stylers": [{"weight": "2.00"}]
        },
        {
          "featureType": "all",
          "elementType": "geometry.stroke",
          "stylers": [{"color": "#9c9c9c"}]
        },
        {
          "featureType": "all",
          "elementType": "labels.text",
          "stylers": [{"visibility": "on"}]
        }
      ]
    });
  }

  // Geocoding function
  function geocodeAddress(address) {
    if (!geocoder) {
      alert("Google Maps APIがまだ初期化されていません");
      return;
    }

    geocoder.geocode({ address: address }, (results, status) => {
      if (status === "OK") {
        latLng = results[0].geometry.location;
        console.log("Geocoding results:", results);
        console.log("Lat:", latLng.lat());
        console.log("Lng:", latLng.lng());

        document.getElementById("demoAddressLatitude").value = latLng.lat();
        document.getElementById("demoAddressLongitude").value = latLng.lng();

        displayMap(latLng);
      } else {
        console.error("Geocode failed due to:", status);
        alert("住所の取得に失敗しました: " + status);
      }
    });
  }

  // Display map function
  function displayMap(latLng) {
    map.setCenter(latLng);

    new google.maps.Marker({
      position: latLng,
      map: map,
      title: "デモ会場",
      animation: google.maps.Animation.BOUNCE
    });

    document.getElementById("map").style.display = "block";
  }

  // Event listeners
  window.onload = () => {
    document.getElementById("showMapButton").addEventListener("click", () => {
      const address = document.getElementById("demoAddress").value;
      if (address) {
        geocodeAddress(address);
      } else {
        alert("住所を入力してください");
      }
    });
  };

  // Form validation
  $(document).ready(function() {
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('demoDate').min = today;
    
    // Validate end time is after start time
    $('#demoStartTime, #demoEndTime').on('change', function() {
      const startTime = $('#demoStartTime').val();
      const endTime = $('#demoEndTime').val();
      
      if (startTime && endTime && startTime >= endTime) {
        alert('終了時間は開始時間より後の時間を選択してください。');
        $('#demoEndTime').val('');
      }
    });
  });
</script>

</body>
</html>
