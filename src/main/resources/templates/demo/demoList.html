<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Demo Wave - ãƒ‡ãƒ¢ä¸€è¦§</title>
  <meta name="description" content="Demo Waveã§é–‹å‚¬ä¸­ãƒ»é–‹å‚¬äºˆå®šã®ãƒ‡ãƒ¢ä¸€è¦§ã‚’ã”è¦§ãã ã•ã„">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    * { font-family: 'Inter', sans-serif; }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .glass-effect {
      backdrop-filter: blur(16px) saturate(180%);
      background-color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .text-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .animate-fade-in {
      animation: fadeIn 0.8s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
    }
    
    .status-active {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    .status-upcoming {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    }
    
    .status-ended {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

<!-- Header -->
<header class="gradient-bg shadow-lg">
  <div class="max-w-7xl mx-auto px-4 py-4">
    <div class="flex justify-between items-center">
      <!-- Logo -->
      <div class="flex items-center space-x-3">
        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
          <i class="fas fa-bullhorn text-white text-xl"></i>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-white">Demo Wave</h1>
          <p class="text-xs text-white opacity-80">ã‚ãªãŸã®å£°ãŒç¤¾ä¼šã‚’å¤‰ãˆã‚‹</p>
        </div>
      </div>
      
      <!-- Navigation -->
      <nav class="flex items-center space-x-6">
        <a href="/demo_wave/lp.html" class="text-white hover:text-purple-200 transition-colors flex items-center">
          <i class="fas fa-home mr-2"></i>
          <span class="hidden sm:block">ãƒ›ãƒ¼ãƒ </span>
        </a>
        <a href="/demo_wave/mypage" class="text-white hover:text-purple-200 transition-colors flex items-center">
          <i class="fas fa-user-circle mr-2"></i>
          <span class="hidden sm:block">ãƒã‚¤ãƒšãƒ¼ã‚¸</span>
        </a>
        
        <!-- User Profile -->
        <div id="userProfile" class="flex items-center space-x-3">
          <div id="userProfileImage" class="w-10 h-10 rounded-full overflow-hidden bg-white bg-opacity-20 flex items-center justify-center relative">
            <img id="profileImg" src="" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" class="w-full h-full object-cover absolute inset-0 hidden">
            <i id="defaultAvatar" class="fas fa-user text-white text-sm"></i>
          </div>
          <span id="userName" class="text-white text-sm font-medium hidden md:block"></span>
        </div>
        
        <a href="/demo_wave/logout" class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg hover:bg-opacity-30 transition-all">
          <i class="fas fa-sign-out-alt mr-2"></i>
          <span class="hidden sm:inline">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</span>
        </a>
      </nav>
    </div>
  </div>
</header>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 py-8">
  <!-- Page Header -->
  <div class="text-center mb-12">
    <h2 class="text-4xl font-bold text-gradient mb-4">ãƒ‡ãƒ¢ä¸€è¦§</h2>
    <p class="text-gray-600 text-lg max-w-2xl mx-auto">
      ç¾åœ¨é–‹å‚¬ä¸­ãƒ»é–‹å‚¬äºˆå®šã®ãƒ‡ãƒ¢ã‚’ã”è¦§ãã ã•ã„ã€‚ã‚ãªãŸã‚‚å‚åŠ ã—ã¦ã€ç¤¾ä¼šã‚’å¤‰ãˆã‚‹ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¾ã—ã‚‡ã†ã€‚
    </p>
  </div>

  <!-- Actions Bar -->
  <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
    <!-- Demo Count -->
    <div class="flex items-center space-x-4">
      <div class="bg-white rounded-xl shadow-md px-6 py-3">
        <div class="text-2xl font-bold text-purple-600" th:text="${#lists.size(demoList)}">12</div>
        <div class="text-sm text-gray-500">é–‹å‚¬ä¸­ã®ãƒ‡ãƒ¢</div>
      </div>
    </div>
    
    <!-- Create Demo Button -->
    <a th:href="@{/demo/create}">
      <button class="gradient-bg text-white font-semibold px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center space-x-2">
        <i class="fas fa-plus"></i>
        <span>æ–°ã—ã„ãƒ‡ãƒ¢ã‚’ä½œæˆ</span>
      </button>
    </a>
  </div>

  <!-- Search and Filter -->
  <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
    <div class="flex flex-col lg:flex-row gap-4 items-center">
      <!-- Search -->
      <div class="flex-1 w-full">
        <div class="relative">
          <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          <input 
            type="text" 
            placeholder="ãƒ‡ãƒ¢ã‚’æ¤œç´¢..." 
            class="w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-100 focus:border-purple-400 outline-none"
          >
        </div>
      </div>
      
      <!-- Filter Buttons -->
      <div class="flex gap-2">
        <select class="px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-100 focus:border-purple-400 outline-none">
          <option>å…¨ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
          <option>ç’°å¢ƒ</option>
          <option>äººæ¨©</option>
          <option>æ”¿æ²»</option>
          <option>ç¤¾ä¼šç¦ç¥‰</option>
        </select>
        <select class="px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-100 focus:border-purple-400 outline-none">
          <option>å…¨ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
          <option>ç’°å¢ƒ</option>
          <option>äººæ¨©</option>
          <option>æ”¿æ²»</option>
          <option>ç¤¾ä¼šç¦ç¥‰</option>
        </select>
        <select class="px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-100 focus:border-purple-400 outline-none">
          <option>å…¨ã¦ã®åœ°åŸŸ</option>
          <option>æ±äº¬éƒ½</option>
          <option>å¤§é˜ªåºœ</option>
          <option>æ„›çŸ¥çœŒ</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Demo Cards Grid -->
  <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-8">
    <div th:each="demo : ${demoList}" class="card-hover bg-white rounded-2xl shadow-lg overflow-hidden animate-fade-in">
      <div class="p-6">
        <!-- Status Badge -->
        <div class="flex justify-between items-start mb-4">
          <span class="status-active text-white text-xs font-semibold px-3 py-1 rounded-full">
            ğŸ”´ é–‹å‚¬ä¸­
          </span>
          <div class="text-right">
            <div class="text-sm text-gray-500">å‚åŠ è€…æ•°</div>
            <div class="text-lg font-bold text-purple-600" th:text="${demo.participantCount}">127</div>
          </div>
        </div>

        <!-- Title -->
        <h3 class="text-xl font-bold text-gray-900 mb-3 line-clamp-2" th:text="${demo.title}">
          æ°—å€™å¤‰å‹•å¯¾ç­–ã‚’æ±‚ã‚ã‚‹ç·Šæ€¥ãƒ‡ãƒ¢
        </h3>

        <!-- Info Grid -->
        <div class="space-y-3 mb-6">
          <!-- Date & Time -->
          <div class="flex items-center text-gray-600">
            <i class="fas fa-calendar-alt w-5 text-purple-500"></i>
            <span class="ml-3 text-sm" th:text="${#temporals.format(demo.demoStartDate, 'yyyyå¹´MMæœˆddæ—¥ HH:mm')}">
              2025å¹´01æœˆ15æ—¥ 14:00
            </span>
          </div>
          
          <!-- Location -->
          <div class="flex items-center text-gray-600">
            <i class="fas fa-map-marker-alt w-5 text-purple-500"></i>
            <span class="ml-3 text-sm" th:text="${demo.demoPlace}">æ¸‹è°·é§…å‰åºƒå ´</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-3">
          <a th:href="@{/demo/show(demoId=${demo.id})}" class="flex-1">
            <button class="w-full gradient-bg text-white font-semibold py-2 px-4 rounded-lg hover:opacity-90 transition-all">
              è©³ç´°ã‚’è¦‹ã‚‹
            </button>
          </a>
          <button class="bg-gray-100 text-gray-600 p-2 rounded-lg hover:bg-gray-200 transition-all">
            <i class="fas fa-heart"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State (if no demos) -->
  <div th:if="${#lists.isEmpty(demoList)}" class="text-center py-16 animate-fade-in">
    <div class="max-w-md mx-auto">
      <div class="w-24 h-24 gradient-bg rounded-full flex items-center justify-center mx-auto mb-6">
        <i class="fas fa-bullhorn text-white text-3xl"></i>
      </div>
      <h3 class="text-2xl font-bold text-gray-900 mb-4">ãƒ‡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“</h3>
      <p class="text-gray-600 mb-8">ç¾åœ¨é–‹å‚¬ä¸­ãƒ»é–‹å‚¬äºˆå®šã®ãƒ‡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>æ–°ã—ã„ãƒ‡ãƒ¢ã‚’ä½œæˆã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ</p>
      <a th:href="@{/demo/create}">
        <button class="gradient-bg text-white font-semibold px-8 py-3 rounded-xl shadow-lg hover:shadow-xl">
          <i class="fas fa-plus mr-2"></i>ãƒ‡ãƒ¢ã‚’ä½œæˆ
        </button>
      </a>
    </div>
  </div>

  <!-- Pagination -->
  <div th:if="${demoList.totalPages} > 1" class="flex justify-center mt-12 animate-fade-in">
    <nav class="flex items-center space-x-2">
      <!-- Previous Button -->
      <a th:href="${demoList.first} ? '#' : @{/demo(page=${demoList.number - 1})}" 
         class="flex items-center justify-center w-10 h-10 rounded-lg border border-gray-200 hover:bg-purple-50 hover:border-purple-300 transition-all"
         th:classappend="${demoList.first} ? 'opacity-50 cursor-not-allowed' : ''">
        <i class="fas fa-chevron-left text-gray-400"></i>
      </a>
      
      <!-- Page Numbers -->
      <div th:each="i : ${#numbers.sequence(0, demoList.totalPages - 1)}" class="flex">
        <a th:href="@{/demo(page=${i})}" 
           th:class="${i == demoList.number} ? 'gradient-bg text-white' : 'bg-white text-gray-700 hover:bg-purple-50'"
           class="flex items-center justify-center w-10 h-10 rounded-lg border border-gray-200 transition-all"
           th:text="${i + 1}">1</a>
      </div>
      
      <!-- Next Button -->
      <a th:href="${demoList.last} ? '#' : @{/demo(page=${demoList.number + 1})}" 
         class="flex items-center justify-center w-10 h-10 rounded-lg border border-gray-200 hover:bg-purple-50 hover:border-purple-300 transition-all"
         th:classappend="${demoList.last} ? 'opacity-50 cursor-not-allowed' : ''">
        <i class="fas fa-chevron-right text-gray-400"></i>
      </a>
    </nav>
  </div>
</main>

<!-- Footer -->
<footer class="bg-gray-900 text-white py-12 mt-16">
  <div class="max-w-7xl mx-auto px-4 text-center">
    <div class="flex items-center justify-center space-x-3 mb-6">
      <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
        <i class="fas fa-bullhorn text-white text-xl"></i>
      </div>
      <h3 class="text-2xl font-bold text-gradient">Demo Wave</h3>
    </div>
    <p class="text-gray-400 mb-6">ã‚ãªãŸã®å£°ãŒç¤¾ä¼šã‚’å¤‰ãˆã‚‹åŠ›ã«ãªã‚‹</p>
    <p class="text-sm text-gray-500">&copy; 2025 Demo Wave. All rights reserved.</p>
  </div>
</footer>

<script>
  // Search functionality
  document.querySelector('input[placeholder="ãƒ‡ãƒ¢ã‚’æ¤œç´¢..."]').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const demoCards = document.querySelectorAll('[th\\:each="demo : ${demoList}"]');
    
    demoCards.forEach(card => {
      const title = card.querySelector('h3').textContent.toLowerCase();
      const location = card.querySelector('[th\\:text="${demo.demoPlace}"]')?.textContent.toLowerCase() || '';
      
      if (title.includes(searchTerm) || location.includes(searchTerm)) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  });

  // Card hover effects
  document.querySelectorAll('.card-hover').forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-4px)';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
    });
  });

  // Favorite button functionality
  document.querySelectorAll('button i.fa-heart').forEach(button => {
    button.parentElement.addEventListener('click', function(e) {
      e.preventDefault();
      const icon = this.querySelector('i');
      
      if (icon.classList.contains('fas')) {
        icon.classList.remove('fas');
        icon.classList.add('far');
        this.classList.remove('bg-red-100', 'text-red-600');
        this.classList.add('bg-gray-100', 'text-gray-600');
      } else {
        icon.classList.remove('far');
        icon.classList.add('fas');
        this.classList.remove('bg-gray-100', 'text-gray-600');
        this.classList.add('bg-red-100', 'text-red-600');
      }
    });
  });

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¦ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¡¨ç¤º
  async function loadUserProfile() {
    try {
      console.log('Loading user profile...');
      const response = await fetch('/demo_wave/api/user/current');
      console.log('Response status:', response.status);
      
      if (response.ok) {
        const userInfo = await response.json();
        console.log('User info:', userInfo);
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’è¡¨ç¤º
        document.getElementById('userName').textContent = userInfo.name;
        document.getElementById('userName').classList.remove('hidden');
        
        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’è¡¨ç¤º
        const profileImg = document.getElementById('profileImg');
        const defaultAvatar = document.getElementById('defaultAvatar');
        
        if (userInfo.profileImagePath) {
          console.log('Setting profile image:', userInfo.profileImagePath);
          profileImg.src = userInfo.profileImagePath;
          profileImg.classList.remove('hidden');
          defaultAvatar.classList.add('hidden');
          // ç”»åƒã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤º
          profileImg.onerror = function() {
            console.log('Profile image failed to load, showing default avatar');
            this.classList.add('hidden');
            defaultAvatar.classList.remove('hidden');
          };
        } else {
          console.log('No profile image, showing default avatar');
          profileImg.classList.add('hidden');
          defaultAvatar.classList.remove('hidden');
        }
        
        console.log('User profile loaded successfully');
      } else {
        const errorText = await response.text();
        console.warn('Failed to load user profile:', response.status, errorText);
      }
    } catch (error) {
      console.error('Error loading user profile:', error);
    }
  }

  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
  loadUserProfile();
</script>

</body>
</html>
